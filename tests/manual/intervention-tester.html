<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attention Trainer - Manual Intervention Testing</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .control-section h3 {
            margin-top: 0;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .status-display {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }

        .test-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 2000px; /* Make it scrollable */
        }

        .content-item {
            margin: 30px 0;
            padding: 20px;
            border-left: 4px solid #3b82f6;
            background: #f8fafc;
        }

        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }

        .slider-value {
            font-weight: bold;
            color: #3b82f6;
        }

        .log-panel {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
        }

        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .log-info { background: rgba(59, 130, 246, 0.2); }
        .log-warn { background: rgba(245, 158, 11, 0.2); }
        .log-error { background: rgba(239, 68, 68, 0.2); }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }

        .metric-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Testing CSS classes */
        .attention-trainer-brightness-transition {
            transition: filter 600ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .attention-trainer-blur {
            filter: blur(var(--stage2-blur, 0.75px));
            transition: filter 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .attention-trainer-dim {
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .attention-trainer-shake {
            animation: shake 0.5s ease-in-out 3;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ Attention Trainer - Manual Intervention Testing</h1>
        <p>This tool helps you manually test the progressive intervention system in a controlled environment.</p>
    </div>

    <div class="control-panel">
        <div class="control-section">
            <h3>üéöÔ∏è Brightness Control</h3>
            <label for="brightnessSlider">Brightness Level: <span id="brightnessValue" class="slider-value">100%</span></label>
            <input type="range" id="brightnessSlider" min="0" max="100" value="100">
            <div>
                <button class="btn" onclick="testBrightnessCurve()">Test Brightness Curve</button>
                <button class="btn btn-secondary" onclick="resetBrightness()">Reset</button>
            </div>
            <div class="status-display">
                Current: <span id="currentBrightness">100%</span> | 
                Applied: <span id="appliedBrightness">100%</span>
            </div>
        </div>

        <div class="control-section">
            <h3>üòµ‚Äçüí´ Blur Effects</h3>
            <label for="blurSlider">Blur Intensity: <span id="blurValue" class="slider-value">0px</span></label>
            <input type="range" id="blurSlider" min="0" max="5" step="0.25" value="0">
            <div>
                <button class="btn" onclick="testBlurProgression()">Test Blur Progression</button>
                <button class="btn btn-secondary" onclick="clearBlur()">Clear Blur</button>
            </div>
            <div class="status-display">
                Applied to: <span id="blurredElements">0 elements</span>
            </div>
        </div>

        <div class="control-section">
            <h3>‚è±Ô∏è Stage Simulation</h3>
            <label for="timeSlider">Simulated Time: <span id="timeValue" class="slider-value">0 min</span></label>
            <input type="range" id="timeSlider" min="0" max="20" value="0">
            <div>
                <button class="btn" onclick="simulateStage(1)">Stage 1</button>
                <button class="btn" onclick="simulateStage(2)">Stage 2</button>
                <button class="btn" onclick="simulateStage(3)">Stage 3</button>
                <button class="btn" onclick="simulateStage(4)">Stage 4</button>
            </div>
            <div class="status-display">
                Current Stage: <span id="currentStage">0</span> | 
                Time: <span id="simulatedTime">0 min</span>
            </div>
        </div>

        <div class="control-section">
            <h3>üé¨ Media Simulation</h3>
            <video id="testVideo" controls style="width: 100%; max-width: 200px;">
                <source src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21tcDQyAAABPG1kYXQAAA==" type="video/mp4">
            </video>
            <div>
                <button class="btn" onclick="simulateMediaActivity()">Play Media</button>
                <button class="btn btn-secondary" onclick="stopMediaActivity()">Stop Media</button>
            </div>
            <div class="status-display">
                Media Active: <span id="mediaStatus">false</span>
            </div>
        </div>
    </div>

    <div class="control-panel">
        <div class="control-section">
            <h3>üìä Real-time Metrics</h3>
            <div class="metrics-grid">
                <div class="metric">
                    <div class="metric-value" id="scrollDistance">0</div>
                    <div class="metric-label">Scroll Distance</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="scrollTime">0s</div>
                    <div class="metric-label">Scroll Time</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="interventionCount">0</div>
                    <div class="metric-label">Interventions</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="currentBrightnessMetric">100%</div>
                    <div class="metric-label">Brightness</div>
                </div>
            </div>
        </div>

        <div class="control-section">
            <h3>üß™ Auto Tests</h3>
            <button class="btn" onclick="runFullProgressionTest()">Full Progression Test</button>
            <button class="btn" onclick="runPerformanceTest()">Performance Test</button>
            <button class="btn" onclick="runEdgeCaseTest()">Edge Case Test</button>
            <button class="btn btn-danger" onclick="clearAllEffects()">Clear All Effects</button>
        </div>
    </div>

    <div class="test-content">
        <h2>üìù Test Content for Interventions</h2>
        <div class="content-item">
            <h3>Sample Article 1</h3>
            <p>This is sample content that will be affected by blur interventions. Keep scrolling to see more content and trigger different stages of the intervention system.</p>
        </div>

        <div class="content-item">
            <h3>Sample Article 2</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2RkZCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TYW1wbGUgSW1hZ2U8L3RleHQ+PC9zdmc+" alt="Sample Image" style="width: 100%; max-width: 400px;">
        </div>

        <div class="content-item">
            <h3>Sample Article 3</h3>
            <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </div>

        <div class="content-item">
            <h3>More Content to Scroll</h3>
            <p>Keep scrolling to test the intervention system. The progressive intervention system should start dimming the screen, then apply blur effects, and finally show intervention messages.</p>
        </div>

        <!-- Repeat content to make it scrollable -->
        <div class="content-item"><h3>Additional Content Block 1</h3><p>More test content...</p></div>
        <div class="content-item"><h3>Additional Content Block 2</h3><p>More test content...</p></div>
        <div class="content-item"><h3>Additional Content Block 3</h3><p>More test content...</p></div>
        <div class="content-item"><h3>Additional Content Block 4</h3><p>More test content...</p></div>
        <div class="content-item"><h3>Additional Content Block 5</h3><p>More test content...</p></div>
    </div>

    <div class="control-section">
        <h3>üìã Testing Log</h3>
        <div id="testLog" class="log-panel"></div>
        <button class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        // Testing state
        let testingState = {
            startTime: Date.now(),
            scrollDistance: 0,
            scrollStartTime: null,
            interventionCount: 0,
            currentStage: 0,
            mediaActive: false,
            brightness: 100,
            blurLevel: 0
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeControls()
            setupScrollTracking()
            log('info', 'Manual testing interface initialized')
        })

        function initializeControls() {
            // Brightness slider
            const brightnessSlider = document.getElementById('brightnessSlider')
            brightnessSlider.addEventListener('input', function() {
                const value = this.value
                document.getElementById('brightnessValue').textContent = value + '%'
                setBrightness(value)
            })

            // Blur slider
            const blurSlider = document.getElementById('blurSlider')
            blurSlider.addEventListener('input', function() {
                const value = this.value
                document.getElementById('blurValue').textContent = value + 'px'
                setBlur(value)
            })

            // Time slider
            const timeSlider = document.getElementById('timeSlider')
            timeSlider.addEventListener('input', function() {
                const value = this.value
                document.getElementById('timeValue').textContent = value + ' min'
                simulateTimeProgression(value)
            })
        }

        function setupScrollTracking() {
            let lastScrollY = window.pageYOffset

            window.addEventListener('scroll', function() {
                if (!testingState.scrollStartTime) {
                    testingState.scrollStartTime = Date.now()
                    log('info', 'Scroll tracking started')
                }

                const currentScrollY = window.pageYOffset
                testingState.scrollDistance += Math.abs(currentScrollY - lastScrollY)
                lastScrollY = currentScrollY

                updateMetrics()
            })

            // Update metrics every second
            setInterval(updateMetrics, 1000)
        }

        function updateMetrics() {
            document.getElementById('scrollDistance').textContent = Math.round(testingState.scrollDistance)
            
            if (testingState.scrollStartTime) {
                const scrollTime = (Date.now() - testingState.scrollStartTime) / 1000
                document.getElementById('scrollTime').textContent = Math.round(scrollTime) + 's'
            }
            
            document.getElementById('interventionCount').textContent = testingState.interventionCount
            document.getElementById('currentBrightnessMetric').textContent = testingState.brightness + '%'
        }

        // Brightness functions
        function setBrightness(percent) {
            const clamped = Math.max(0, Math.min(100, Math.round(percent)))
            testingState.brightness = clamped
            document.documentElement.style.filter = `brightness(${clamped}%)`
            document.documentElement.classList.add('attention-trainer-brightness-transition')
            
            document.getElementById('currentBrightness').textContent = clamped + '%'
            document.getElementById('appliedBrightness').textContent = clamped + '%'
            
            log('info', `Brightness set to ${clamped}%`)
        }

        function testBrightnessCurve() {
            log('info', 'Testing brightness curve progression')
            const timePoints = [0, 1, 2, 3, 5, 8, 10, 15]
            let i = 0

            function nextPoint() {
                if (i < timePoints.length) {
                    const minutes = timePoints[i]
                    let brightness = 100

                    // Implement the same curve as the extension
                    if (minutes <= 3) {
                        brightness = 100 - (20 * (minutes / 3))
                    } else if (minutes <= 10) {
                        const t = (minutes - 3) / 7
                        brightness = 80 - (30 * t)
                    } else {
                        brightness = 50
                    }

                    setBrightness(brightness)
                    log('info', `Time: ${minutes}min ‚Üí Brightness: ${Math.round(brightness)}%`)
                    
                    i++
                    setTimeout(nextPoint, 1000)
                }
            }
            nextPoint()
        }

        function resetBrightness() {
            setBrightness(100)
            document.getElementById('brightnessSlider').value = 100
            document.getElementById('brightnessValue').textContent = '100%'
            log('info', 'Brightness reset to 100%')
        }

        // Blur functions
        function setBlur(pixels) {
            testingState.blurLevel = pixels
            const elements = document.querySelectorAll('p, span, div:not([class*="control"]):not([class*="header"]), img, article, .content-item')
            
            elements.forEach(el => {
                if (pixels > 0) {
                    el.classList.add('attention-trainer-blur')
                    el.style.setProperty('--stage2-blur', pixels + 'px')
                } else {
                    el.classList.remove('attention-trainer-blur')
                    el.style.removeProperty('--stage2-blur')
                }
            })

            document.getElementById('blurredElements').textContent = pixels > 0 ? elements.length + ' elements' : '0 elements'
            log('info', `Blur set to ${pixels}px on ${elements.length} elements`)
        }

        function testBlurProgression() {
            log('info', 'Testing blur progression')
            const blurLevels = [0, 0.25, 0.5, 0.75, 1.0, 1.5, 2.0]
            let i = 0

            function nextBlur() {
                if (i < blurLevels.length) {
                    setBlur(blurLevels[i])
                    document.getElementById('blurSlider').value = blurLevels[i]
                    document.getElementById('blurValue').textContent = blurLevels[i] + 'px'
                    i++
                    setTimeout(nextBlur, 1500)
                }
            }
            nextBlur()
        }

        function clearBlur() {
            setBlur(0)
            document.getElementById('blurSlider').value = 0
            document.getElementById('blurValue').textContent = '0px'
            log('info', 'Blur effects cleared')
        }

        // Stage simulation
        function simulateStage(stage) {
            testingState.currentStage = stage
            testingState.interventionCount++
            document.getElementById('currentStage').textContent = stage

            log('warn', `Simulating Stage ${stage} intervention`)

            switch(stage) {
                case 1:
                    // Brightness dimming + slight visual cue
                    setBrightness(85)
                    document.body.classList.add('attention-trainer-dim')
                    setTimeout(() => document.body.classList.remove('attention-trainer-dim'), 2000)
                    break
                case 2:
                    // Progressive blur + shake
                    setBrightness(70)
                    setBlur(0.75)
                    document.body.classList.add('attention-trainer-shake')
                    setTimeout(() => document.body.classList.remove('attention-trainer-shake'), 1500)
                    break
                case 3:
                    // Enhanced nudge message
                    setBrightness(60)
                    setBlur(1.0)
                    showTestNudge()
                    break
                case 4:
                    // Final warning
                    setBrightness(50)
                    setBlur(1.5)
                    showTestWarning()
                    break
            }

            updateMetrics()
        }

        function simulateTimeProgression(minutes) {
            document.getElementById('simulatedTime').textContent = minutes + ' min'
            
            // Auto-apply appropriate brightness for time
            let brightness = 100
            if (minutes <= 3) {
                brightness = 100 - (20 * (minutes / 3))
            } else if (minutes <= 10) {
                const t = (minutes - 3) / 7
                brightness = 80 - (30 * t)
            } else {
                brightness = 50
            }
            
            setBrightness(brightness)

            // Auto-trigger stages based on time
            let expectedStage = 0
            if (minutes >= 15) expectedStage = 4
            else if (minutes >= 12) expectedStage = 3
            else if (minutes >= 10) expectedStage = 2
            else if (minutes >= 1) expectedStage = 1

            if (expectedStage !== testingState.currentStage && expectedStage > 0) {
                log('info', `Auto-triggering Stage ${expectedStage} at ${minutes} minutes`)
                simulateStage(expectedStage)
            }
        }

        // Media simulation
        function simulateMediaActivity() {
            testingState.mediaActive = true
            document.getElementById('mediaStatus').textContent = 'true'
            const video = document.getElementById('testVideo')
            video.play().catch(() => {})
            log('info', 'Media activity simulated')
        }

        function stopMediaActivity() {
            testingState.mediaActive = false
            document.getElementById('mediaStatus').textContent = 'false'
            const video = document.getElementById('testVideo')
            video.pause()
            log('info', 'Media activity stopped')
        }

        // Test functions
        function runFullProgressionTest() {
            log('warn', 'Starting full progression test')
            clearAllEffects()
            
            let currentTime = 0
            const testInterval = setInterval(() => {
                currentTime += 1
                document.getElementById('timeSlider').value = currentTime
                simulateTimeProgression(currentTime)
                
                if (currentTime >= 20) {
                    clearInterval(testInterval)
                    log('info', 'Full progression test completed')
                }
            }, 2000)
        }

        function runPerformanceTest() {
            log('warn', 'Starting performance test')
            const startTime = performance.now()
            
            // Rapid stage changes
            for (let i = 1; i <= 4; i++) {
                setTimeout(() => simulateStage(i), i * 500)
            }
            
            // Brightness rapid changes
            for (let b = 100; b >= 50; b -= 5) {
                setTimeout(() => setBrightness(b), (100 - b) * 100)
            }
            
            setTimeout(() => {
                const endTime = performance.now()
                log('info', `Performance test completed in ${Math.round(endTime - startTime)}ms`)
            }, 3000)
        }

        function runEdgeCaseTest() {
            log('warn', 'Starting edge case test')
            
            // Test edge cases
            setBrightness(-10)  // Should clamp to 0
            setTimeout(() => setBrightness(150), 500)  // Should clamp to 100
            setTimeout(() => setBlur(-1), 1000)  // Should handle gracefully
            setTimeout(() => setBlur(10), 1500)  // Very high blur
            
            setTimeout(() => {
                log('info', 'Edge case test completed')
                clearAllEffects()
            }, 3000)
        }

        function clearAllEffects() {
            resetBrightness()
            clearBlur()
            document.body.classList.remove('attention-trainer-dim', 'attention-trainer-shake')
            document.documentElement.style.filter = ''
            testingState.currentStage = 0
            document.getElementById('currentStage').textContent = '0'
            
            // Clear any test overlays
            document.querySelectorAll('.test-overlay').forEach(el => el.remove())
            
            log('info', 'All effects cleared')
        }

        // UI helpers
        function showTestNudge() {
            const nudge = document.createElement('div')
            nudge.className = 'test-overlay'
            nudge.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 30px; border-radius: 15px;
                box-shadow: 0 20px 50px rgba(0,0,0,0.3); z-index: 999999;
                text-align: center; max-width: 400px;
            `
            nudge.innerHTML = `
                <h3>üéØ Take a mindful pause</h3>
                <p>You've been scrolling for a while. What were you looking for?</p>
                <button onclick="this.parentElement.remove()" style="padding: 10px 20px; margin: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px;">Continue</button>
                <button onclick="this.parentElement.remove()" style="padding: 10px 20px; margin: 10px; background: #10b981; color: white; border: none; border-radius: 5px;">Focus Mode</button>
            `
            document.body.appendChild(nudge)
            
            setTimeout(() => nudge.remove(), 5000)
        }

        function showTestWarning() {
            const warning = document.createElement('div')
            warning.className = 'test-overlay'
            warning.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: #fee2e2; border: 3px solid #ef4444; padding: 30px; border-radius: 15px;
                box-shadow: 0 20px 50px rgba(0,0,0,0.3); z-index: 999999;
                text-align: center; max-width: 400px;
            `
            warning.innerHTML = `
                <h3 style="color: #ef4444;">‚ö†Ô∏è Attention overload detected</h3>
                <p>You've been scrolling for an extended period. Time for a break?</p>
                <button onclick="this.parentElement.remove()" style="padding: 10px 20px; margin: 10px; background: #ef4444; color: white; border: none; border-radius: 5px;">Take Break</button>
                <button onclick="this.parentElement.remove()" style="padding: 10px 20px; margin: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px;">Focus Now</button>
            `
            document.body.appendChild(warning)
            
            setTimeout(() => warning.remove(), 8000)
        }

        // Logging
        function log(level, message) {
            const logPanel = document.getElementById('testLog')
            const entry = document.createElement('div')
            entry.className = `log-entry log-${level}`
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${level.toUpperCase()}: ${message}`
            logPanel.appendChild(entry)
            logPanel.scrollTop = logPanel.scrollHeight
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = ''
            log('info', 'Log cleared')
        }
    </script>
</body>
</html>
